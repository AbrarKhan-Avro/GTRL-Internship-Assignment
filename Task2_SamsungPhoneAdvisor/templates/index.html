<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Samsung Phone Advisor</title>
  <link rel="stylesheet" href="/static/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
  <header>
    <h1>
      <img
        src="https://upload.wikimedia.org/wikipedia/commons/6/61/Samsung_old_logo_before_year_2015.svg"
        alt="Samsung"
        class="logo"
        width="100"
      />
      Phone Advisor
    </h1>
  </header>

  <main>
    <div id="chat-box">
      <div class="placeholder">üí¨ Ask anything about Samsung phones (e.g., ‚ÄúCompare S25 Ultra and S25 FE for photography‚Äù).</div>
    </div>

    <form id="ask-form">
      <input
        type="text"
        id="question"
        placeholder="Type your question..."
        required
      />
      <button type="submit">Ask</button>
    </form>
  </main>

  <footer>
    ¬© 2025 <span>Samsung Phone Advisor</span> ‚Äî Powered by Groq + FastAPI
  </footer>

  <script>
    const form = document.getElementById("ask-form");
    const chatBox = document.getElementById("chat-box");

    function addMessage(text, sender = "user", markdown = false) {
      const wrapper = document.createElement("div");
      wrapper.className = `msg ${sender}`;

      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.innerHTML = markdown ? marked.parse(text) : text;

      wrapper.appendChild(bubble);
      chatBox.appendChild(wrapper);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function addThinking() {
      const wrapper = document.createElement("div");
      wrapper.className = "msg bot";
      const bubble = document.createElement("div");
      bubble.className = "bubble thinking";
      bubble.innerHTML = `<span></span><span></span><span></span>`;
      wrapper.appendChild(bubble);
      chatBox.appendChild(wrapper);
      chatBox.scrollTop = chatBox.scrollHeight;
      return wrapper;
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const question = document.getElementById("question").value.trim();
      if (!question) return;

      addMessage(question, "user");
      document.getElementById("question").value = "";

      const think = addThinking();

      try {
        const res = await fetch("/ask", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question }),
        });
        const data = await res.json();

        think.remove();
        addMessage(data.answer || "No response.", "bot", true);
      } catch (err) {
        think.remove();
        addMessage("‚ö†Ô∏è Error connecting to server.", "bot");
        console.error(err);
      }
    });
  </script>
</body>
</html>
